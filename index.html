<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Green Arena - Ludo & Chess</title>
<style>
body {margin:0;font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#6a11cb,#2575fc);color:#fff;transition:background 0.5s ease;}
.hidden{display:none;}
.container{max-width:600px;margin:30px auto;padding:20px;background:rgba(255,255,255,0.1);border-radius:15px;box-shadow:0 10px 20px rgba(0,0,0,0.2);transition:all 0.4s ease;}
h2,h3{text-align:center;margin-bottom:20px;}
input{width:100%;padding:12px 15px;margin:10px 0;border:none;border-radius:10px;outline:none;font-size:16px;background: rgba(255,255,255,0.2);color:#fff;}
button{width:100%;padding:12px;margin:10px 0;border:none;border-radius:12px;font-size:18px;cursor:pointer;transition: all 0.3s ease;}
button:hover{transform:translateY(-3px);box-shadow:0 5px 15px rgba(0,0,0,0.3);}
.switch{background:transparent;color:#fff;font-size:14px;cursor:pointer;text-align:center;display:block;margin-top:10px;}
#errorDiv{color:#ff6b6b;text-align:center;margin-bottom:10px;}
.dashboard{display:flex;flex-direction:column;gap:15px;}
.game-card{background: rgba(255,255,255,0.15);border-radius:15px;padding:20px;text-align:center;cursor:pointer;transition: transform 0.3s ease, background 0.3s ease;}
.game-card:hover{background: rgba(255,255,255,0.25); transform: translateY(-5px);}
#coinsDisplay{text-align:center;font-weight:bold;margin-bottom:10px;}
#chessBoard{display:grid;grid-template-columns: repeat(8,60px);grid-template-rows: repeat(8,60px);margin:20px auto;gap:0;border-radius:10px;overflow:hidden;}
.square{display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:30px;cursor:pointer;transition: background 0.3s ease;}
.light{background:#f0d9b5;color:#000;}
.dark{background:#b58863;color:#fff;}
.selected{background:#4caf50 !important;}
#ludoBoard{width:400px;height:400px;margin:20px auto;position:relative;background:#fff;border-radius:15px;overflow:hidden;}
.ludo-cell{width:50px;height:50px;box-sizing:border-box;position:absolute;text-align:center;line-height:50px;font-weight:bold;border:1px solid #ccc;border-radius:5px;}
.ludo-token{width:30px;height:30px;border-radius:50%;position:absolute;text-align:center;line-height:30px;font-weight:bold;cursor:pointer;}
#diceRoll{text-align:center;margin:10px;color:#000;}
#diceRoll button{width:120px;margin:5px auto;display:block;}
</style>
</head>
<body>

<!-- Authentication -->
<div id="authContainer" class="container">
<h2 id="formTitle">Login</h2>
<div id="errorDiv"></div>
<input type="text" id="name" placeholder="Username" style="display:none;">
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button id="submitBtn">Login</button>
<span id="switchMode" class="switch">Don't have an account? Register</span>
</div>

<!-- Dashboard -->
<div id="dashboardContainer" class="container hidden">
<h3>Hello, <span id="userDisplay"></span></h3>
<p id="coinsDisplay">Coins: 0</p>
<div class="dashboard">
  <div class="game-card" onclick="selectGameMode('ludo')"><h4>Ludo</h4><p>Play against player or AI</p></div>
  <div class="game-card" onclick="selectGameMode('chess')"><h4>Chess</h4><p>Play against player or AI</p></div>
</div>
<button onclick="logout()">Logout</button>
</div>

<!-- Coin / Mode Selection -->
<div id="coinSelector" class="container hidden">
<h3>Select Mode & Coins</h3>
<p>Select mode:</p>
<button onclick="startAI()">Play with AI (No Coins)</button>
<p>Or play with player:</p>
<input type="number" id="stakeCoins" placeholder="Enter coins to stake">
<button onclick="startPlayerGame()">Start Player Game</button>
<button onclick="cancelCoinSelect()">Cancel</button>
</div>

<!-- Game Area -->
<div id="gameArea" class="container hidden">
<h3 id="gameTitle"></h3>

<!-- Chess -->
<div id="chessBoard" class="hidden"></div>

<!-- Ludo -->
<div id="ludoBoard" class="hidden">
  <div id="diceRoll"><button onclick="rollDice()">Roll Dice</button><span id="diceResult"></span></div>
</div>

<button onclick="leaveGame()">Leave Game</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js";
import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-auth.js";
import { getDatabase, ref, set, push, update, remove, onValue, get } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-database.js";

// --------------------
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDSInVpQdq_ZkXt4PPhKVriH-eIuJW1vgg",
  authDomain: "green-arena-68fd8.firebaseapp.com",
  databaseURL: "https://green-arena-68fd8-default-rtdb.firebaseio.com",
  projectId: "green-arena-68fd8",
  storageBucket: "green-arena-68fd8.firebasestorage.app",
  messagingSenderId: "5088114396",
  appId: "1:5088114396:web:f397d3f21500be65ab6619"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getDatabase();

// --------------------
// DOM Elements
const authContainer=document.getElementById("authContainer");
const dashboardContainer=document.getElementById("dashboardContainer");
const submitBtn=document.getElementById("submitBtn");
const switchMode=document.getElementById("switchMode");
const formTitle=document.getElementById("formTitle");
const errorDiv=document.getElementById("errorDiv");
const coinsDisplay=document.getElementById("coinsDisplay");
const coinSelector=document.getElementById("coinSelector");
const chessBoard=document.getElementById("chessBoard");
const ludoBoard=document.getElementById("ludoBoard");
const diceResult=document.getElementById("diceResult");

let isLogin=true, currentUser=null, currentGameId=null, currentGameType=null, stakeCoins=0;
let selectedSquare=null, ludoState=null;

// --------------------
// Auth Logic
switchMode.addEventListener("click",()=>{
  isLogin=!isLogin;
  formTitle.innerText=isLogin?"Login":"Register";
  submitBtn.innerText=isLogin?"Login":"Register";
  switchMode.innerText=isLogin?"Don't have an account? Register":"Already have an account? Login";
  document.getElementById("name").style.display=isLogin?"none":"block";
  errorDiv.innerText="";
});

submitBtn.addEventListener("click",async()=>{
  const name=document.getElementById("name").value.trim();
  const email=document.getElementById("email").value.trim();
  const password=document.getElementById("password").value.trim();
  errorDiv.innerText="";
  if(!email||!password){ errorDiv.innerText="Please fill all fields."; return;}
  try{
    if(isLogin){
      const userCredential=await signInWithEmailAndPassword(auth,email,password);
      currentUser=userCredential.user;
      authContainer.classList.add("hidden");
      dashboardContainer.classList.remove("hidden");
      document.getElementById("userDisplay").innerText=currentUser.email;
      listenCoins();
    } else {
      if(!name){ errorDiv.innerText="Name required."; return;}
      const userCredential=await createUserWithEmailAndPassword(auth,email,password);
      const user=userCredential.user;
      await set(ref(db,"users/"+user.uid),{name,email,coins:1000});
      currentUser=user;
      authContainer.classList.add("hidden");
      dashboardContainer.classList.remove("hidden");
      document.getElementById("userDisplay").innerText=currentUser.email;
      listenCoins();
    }
  }catch(err){console.error(err);errorDiv.innerText=err.message; alert(err.message);}
});

onAuthStateChanged(auth,user=>{
  if(user){currentUser=user; authContainer.classList.add("hidden"); dashboardContainer.classList.remove("hidden"); document.getElementById("userDisplay").innerText=user.email; listenCoins();}
  else{authContainer.classList.remove("hidden"); dashboardContainer.classList.add("hidden");}
});

window.logout=()=>signOut(auth);

function listenCoins(){
  if(!currentUser) return;
  onValue(ref(db,"users/"+currentUser.uid+"/coins"),snap=>{
    coinsDisplay.innerText="Coins: "+(snap.val()||0);
  });
}

// --------------------
// Game Mode Selection
function selectGameMode(type){currentGameType=type; coinSelector.classList.remove("hidden");}
function cancelCoinSelect(){coinSelector.classList.add("hidden");}
function startAI(){stakeCoins=0; coinSelector.classList.add("hidden"); startGame(true);}
function startPlayerGame(){stakeCoins=parseInt(document.getElementById("stakeCoins").value); if(!stakeCoins||stakeCoins<1){alert("Enter valid coins"); return;} coinSelector.classList.add("hidden"); startGame(false);}

// --------------------
// Start Game
async function startGame(isAI){
  const gameRef=push(ref(db,"games"));
  currentGameId=gameRef.key;
  let boardData;
  if(currentGameType==="chess") boardData=[
      ["r","n","b","q","k","b","n","r"],
      ["p","p","p","p","p","p","p","p"],
      ["","","","","","","",""],
      ["","","","","","","",""],
      ["","","","","","","",""],
      ["","","","","","","",""],
      ["P","P","P","P","P","P","P","P"],
      ["R","N","B","Q","K","B","N","R"]
    ];
  else boardData={tokens:{red:[0,0,0,0],green:[0,0,0,0],yellow:[0,0,0,0],blue:[0,0,0,0]},turn:"red",dice:1};
  await set(gameRef,{type:currentGameType+(isAI?"_ai":""),board:boardData,players:{player1:currentUser.uid},stake:stakeCoins,ai:isAI});
  openGame(currentGameType+(isAI?"_ai":""));
}

// --------------------
// Open Game
function openGame(type){
  dashboardContainer.classList.add("hidden");
  document.getElementById("gameArea").classList.remove("hidden");
  document.getElementById("gameTitle").innerText=type.toUpperCase();
  if(type.includes("chess")){ renderChess(); listenChess(); }
  if(type.includes("ludo")){ renderLudo(); listenLudo(); }
}
window.leaveGame=()=>{ if(currentGameId) remove(ref(db,"games/"+currentGameId)); location.reload(); }

// --------------------
// Ludo / Chess placeholder functions for next step
function rollDice(){ if(!ludoState) return; let val=Math.floor(Math.random()*6)+1; diceResult.innerText=val; ludoMove(val);}
function ludoMove(val){ console.log("Dice rolled:",val); }
function renderChess(){chessBoard.classList.remove("hidden");}
function listenChess(){ console.log("Chess listener ready"); }
function renderLudo(){ludoBoard.classList.remove("hidden");}
function listenLudo(){ console.log("Ludo listener ready"); }

</script>
</body>
</html>
